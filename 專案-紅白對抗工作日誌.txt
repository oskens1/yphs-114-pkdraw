=========================================
      專案：紅白對抗賽 - 開發與修復工作日誌
=========================================

[2026-02-19 歷程紀錄]

這是一個值得紀念的日子。我們在 Vercel 雲端環境中，經歷了超過 50 次的建置與部署測試，終於徹底打通了系統的任督二脈。

### 🎭 心路歷程：從 50 次試錯到全面復活
開發的過程中，最令人沮喪的莫過於那種「本地跑得好好的，上雲端就死圖」的無力感。我們面對的是 Vercel 嚴苛的唯讀檔案系統、Google Sheets 神秘的權限 403 門檻，以及 Cloudinary 那稍縱即逝的簽名驗證。

每一次的 `Internal Server Error` 都像是一道牆，但我們沒有繞路。為了抓出 Bug，我們在程式碼裡裝滿了診斷器，讓系統「學會說話」。從解析 PEM 金鑰的字串地獄，到手動在 Google Cloud 點下那個被遺忘的「啟用 API」按鈕，這不僅是程式碼的修正，更是一場耐心與細節的拉鋸戰。

當我們終於看到「連線成功」四個字，並在 Google Sheets 裡看到第一行由程式自動寫入的資料時，所有的試錯（那傳說中的 50 多次！）都變成了最寶貴的經驗值。這份日誌記載的不只是代碼，更是我們一起攻克技術難關的血淚與榮耀。

---

### 🛠️ 截至 v1.1.8 的核心修復摘要

1. **Google Sheets 權限攻堅**
   - 克服了 Vercel 環境變數對 `private_key` 的轉義干擾，實施了暴力還原邏輯。
   - 確認並啟動了 Google Cloud Console 中的 Sheets API 與 Drive API。
   - 成功驗證服務帳號 Email 權限與試算表 ID 配置。

2. **Cloudinary 圖片同步與死圖修復**
   - 解決了 Vercel `/tmp` 路徑與靜態路徑不一致導致的上傳失敗。
   - 修正了 `API_SECRET` 的簽名錯誤 (Invalid Signature)。
   - 加入了環境變數自動清理功能 (`.strip()`)，杜絕空格干擾。
   - 強制上傳邏輯：確保每一張圖片都成功轉換為雲端網址後，才寫入資料庫。

3. **系統功能穩固化**
   - 強化 Reset 功能：現在重設系統會同步清空 Google Sheets 的內容，確保每次測試都是乾淨的。
   - 依賴庫補完：手動補齊了 Vercel 環境缺失的 `Pillow` 套件。
   - 診斷系統：建立了 `/test_sheet` 與 `/test_cloudinary` 專用診斷介面，方便未來維護。

4. **介面優化**
   - 標題正式更名為「紅白對抗賽控制台」。
   - 加入了版本控制系統 (Version Control Display)，讓每一次更新都清晰可見。

---

### 📋 當前系統狀態 (Version: v1.1.8)
- [x] 後端與 Google Sheets 連線狀態：正常 (已實測寫入)
- [x] 後端與 Cloudinary 連線狀態：正常 (已實測上傳)
- [x] PDF 處理與圖片自動上傳：正常
- [x] Admin 控制台功能：正常

[日誌持續更新中，請勿刪除上方內容]
