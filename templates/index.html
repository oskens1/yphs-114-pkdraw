<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¨ ç•«çŸ¥ç´…ç™½å¤§å°æŠ— ğŸ¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #e9e4d1 !important; /* åœ–ä¸­çš„ç±³ç™½è‰²èƒŒæ™¯ */
            color: #004098; /* åœ–ä¸­çš„æ·±è—è‰² */
            font-family: "Microsoft JhengHei", "Source Han Serif", serif;
        }
        .work-img {
            max-width: 100%;
            height: auto;
            border: 5px solid transparent;
            cursor: pointer;
            transition: transform 0.2s;
            background-color: white;
            border-radius: 4px;
        }
        .work-img:hover {
            transform: scale(1.02);
        }
        .card-red {
            background-color: #c00010 !important; /* åœ–ä¸­çš„æ·±ç´…è‰² */
            color: white;
            border: none;
            border-radius: 0;
        }
        .card-white {
            background-color: #ffffff !important; /* ç´”ç™½ */
            color: #004098; /* æ·±è—è‰²æ–‡å­— */
            border: 1px solid #dee2e6;
            border-radius: 0;
        }
        .voted {
            border-color: #004098 !important; /* æŠ•ç¥¨å¾Œæ·±è—æ¡† */
            box-shadow: 0 0 20px rgba(0, 64, 152, 0.5);
        }
        .match-container {
            display: none;
        }
        .waiting-container {
            text-align: center;
            margin-top: 100px;
        }
        h1 {
            font-weight: 900;
            color: #004098;
            letter-spacing: 4px;
        }
        .btn-vote-red {
            background-color: #ffffff;
            color: #c00010;
            border: 2px solid #ffffff;
            border-radius: 0;
        }
        .btn-vote-red:hover {
            background-color: #c00010;
            color: #ffffff;
            border: 2px solid #ffffff;
        }
        .btn-vote-white {
            background-color: #004098;
            color: #ffffff;
            border: none;
            border-radius: 0;
        }
        .btn-vote-white:hover {
            background-color: #003380;
        }
        .waiting-container h3 {
            color: #004098;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-5">ğŸ¨ ç•«çŸ¥ç´…ç™½å¤§å°æŠ— ğŸ¨</h1>

        <div id="waiting" class="waiting-container">
            <div class="spinner-border text-light mb-3" role="status"></div>
            <h3>ç›®å‰æ²’æœ‰é€²è¡Œä¸­çš„ PK</h3>
            <p>è«‹ç­‰å¾…è€å¸«é–‹å•Ÿä¸‹ä¸€è¼ªå°æŠ—...</p>
        </div>

        <div id="match" class="match-container">
            <div class="row">
                <div class="col-md-6 mb-4 text-center">
                    <div class="card shadow-lg card-red h-100">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <h2 class="mb-4">ğŸ”´ ç´…éšŠ</h2>
                            <div>
                                <img id="imgA" src="" class="work-img mb-4 shadow" onclick="vote('A')">
                            </div>
                            <button id="btnA" class="btn btn-vote-red btn-lg w-100 fw-bold py-3 shadow-sm" onclick="vote('A')">æŠ•ç´…éšŠä¸€ç¥¨</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4 text-center">
                    <div class="card shadow-lg card-white h-100">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <h2 class="mb-4">âšª ç™½éšŠ</h2>
                            <div>
                                <img id="imgB" src="" class="work-img mb-4 shadow" onclick="vote('B')">
                            </div>
                            <button id="btnB" class="btn btn-vote-white btn-lg w-100 fw-bold py-3 shadow-sm" onclick="vote('B')">æŠ•ç™½éšŠä¸€ç¥¨</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="vote-status" class="text-center mt-4 h3 text-warning fw-bold" style="display:none; text-shadow: 1px 1px 2px black;">
                âœ… æŠ•ç¥¨æˆåŠŸï¼è«‹ç­‰å¾…ä¸‹ä¸€è¼ª
            </div>
        </div>
    </div>

    <script>
        let currentMatchId = null;
        let hasVoted = false;

        async function checkStatus() {
            try {
                const response = await fetch('/status');
                const data = await response.json();
                
                if (data.current_match && data.current_match.status === 'voting') {
                    const matchId = data.current_match.A.id + '_' + data.current_match.B.id;
                    if (matchId !== currentMatchId) {
                        currentMatchId = matchId;
                        hasVoted = false;
                        showMatch(data.current_match);
                    }
                } else {
                    currentMatchId = null;
                    showWaiting();
                }
            } catch (e) {
                console.error("Error checking status", e);
            }
        }

        function showMatch(match) {
            document.getElementById('waiting').style.display = 'none';
            document.getElementById('match').style.display = 'block';
            document.getElementById('imgA').src = match.A.image_url;
            document.getElementById('imgB').src = match.B.image_url;
            
            // ç§»é™¤ä¹‹å‰çš„é¸ä¸­æ•ˆæœ
            document.getElementById('imgA').classList.remove('voted');
            document.getElementById('imgB').classList.remove('voted');
            
            if (hasVoted) {
                document.getElementById('vote-status').style.display = 'block';
                document.getElementById('btnA').disabled = true;
                document.getElementById('btnB').disabled = true;
            } else {
                document.getElementById('vote-status').style.display = 'none';
                document.getElementById('btnA').disabled = false;
                document.getElementById('btnB').disabled = false;
            }
        }

        function showWaiting() {
            document.getElementById('waiting').style.display = 'block';
            document.getElementById('match').style.display = 'none';
        }

        async function vote(choice) {
            if (hasVoted) return;

            const formData = new FormData();
            formData.append('choice', choice);

            try {
                const response = await fetch('/vote', {
                    method: 'POST',
                    body: formData
                });
                if (response.ok) {
                    hasVoted = true;
                    document.getElementById('vote-status').style.display = 'block';
                    document.getElementById('btnA').disabled = true;
                    document.getElementById('btnB').disabled = true;
                    if (choice === 'A') {
                        document.getElementById('imgA').classList.add('voted');
                    } else {
                        document.getElementById('imgB').classList.add('voted');
                    }
                }
            } catch (e) {
                alert("æŠ•ç¥¨å¤±æ•—");
            }
        }

        setInterval(checkStatus, 2000);
        checkStatus();
    </script>
</body>
</html>
